- hosts: run
  gather_facts: false
  connection: ssh
  #sudo: yes
  vars:
    username: cyen

  #vars_prompt:
  #  name: "pw"
  #  prompt: "Enter password"
  #  private: yes

  tasks:
    - name: Make ssh dir
      command: mkdir -p ~{{ username }}/.ssh
      ignore_errors: no

    - name: create configs dir
      shell: rm -rf configs; mkdir ~/configs;rm -f ~/.ssh/knowh_hosts
      ignore_errors: no
    - name: SCP configs
      command: scp -r -o "StrictHostKeyChecking no" cwy.cloud.phx3.gdg:~/configs/ ~/
      ignore_errors: no
    - name: SCP certs
      command: scp -r -o "StrictHostKeyChecking no" cwy.cloud.phx3.gdg:~/.ssh/authorized_keys cwy.cloud.phx3.gdg:~/.ssh/id_rsa* cwy.cloud.phx3.gdg:~/.ssh/known_hosts  ~/.ssh/
      ignore_errors: no

    - name: check if fasd is installed
      stat: path=/usr/local/bin/fasd
      register: fasd
    - name: Download fasd
      command: chdir=/tmp wget https://github.com/clvv/fasd/tarball/1.0.1
      ignore_errors: no
      when: not fasd.stat.exists
    - name: unzip 
      command: chdir=/tmp tar zxvf 1.0.1
      ignore_errors: no
      when: not fasd.stat.exists
    - name: install
      command: chdir=/tmp/clvv-fasd-4822024 make install 
      become: true
      ignore_errors: no
      when: not fasd.stat.exists

    - name: check epel rpm
      shell: rpm -q epel-release
      register: rpm1
      ignore_errors: yes
    - name: install rpm
      command: rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
      become: true
      ignore_errors: yes
      when: rpm1.stdout != "epel-release-6-8.noarch"

    - name: check remi rpm
      shell: rpm -q remi-release
      register: rpm2
      ignore_errors: yes
    - name: install rpm 2
      command: rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
      become: true
      ignore_errors: yes
      when: rpm2.stdout != "remi-release-6.8-1.el6.remi.noarch"

    - name: create links
      command: chdir=~/configs ./create_link.sh
      ignore_errors: no
